---
title: "QFISH Report"
output: html_document
date: "2025-09-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```
# Obtain data

Catch data was obtained from [QFISH Shark Control program](https://qfish.fisheries.qld.gov.au/).

Download the data into your data folder.

Open the data in excel first and combine rows two and three into the first row. Separate the species group from the location using an underscore. This will make it easier to tidy within R.


# Load data and tidy it

Load tidyverse.
```{r, message=FALSE}
library(tidyverse)
```

Read data, make sure the header is set to true and replace all blank cells with zero.

```{r}
data <- read.csv("../data/QFISH_data_v2.csv", header = T)
data[data == ""] <- 0 

head(data)
```


Remove unnecessary columns and rows.
```{r}
data1 <- data[c(-1,-2,-28),c(-13,-26,-40,-54,-55)]

head(data1)
```

Pivot the data so the species group and location are columns. Then separate the species and location using the name pattern, and change the catch to numeric values.
```{r}
clean_data <- data1 %>% pivot_longer(cols = 2:50, names_to = c("SpeciesGroup","Location"), values_to = "Catch", names_pattern = "(.+)_(.+)", values_drop_na = T) #species group and location are separated by _ so we can use a regex code in names_pattern

clean_data$Catch <- as.numeric(as.character(clean_data$Catch))

head(clean_data)
```

# Plot data

We want to make a faceted line plot. Facets are the locations, x-axis is time, y-axis is catch, and groups within each facet are the species.
```{r}
 variable_labs <- c("Bribie.Island" = "Bribie Island", 
                    "Capricorn.Coast" = "Capricorn Coast",
                    "Cairns" = "Cairns",
                    "Gold.Coast" = "Gold Coast",
                    "Mackay" = "Mackay",
                    "Nth.Stradbroke.Is." = "North Stradbroke Island",
                    "Rainbow.Beach" = "Rainbow Beach",
                    "Sunshine.Coast.North" = "North Sunshine Coast", 
                    "Sunshine.Coast.South" = "South Sunshine Coast",
                    "Sunshine.Coast.South...Bribie.Island" = "South Sunshine Coast & Bribie Island",
"Townsville" = "Townsville",
"Bundaberg" = "Bundaberg",
"Gladstone" = "Gladstone") #Change the location names from periods to normal text

clean_data %>% ggplot() +
  theme_bw() +
  facet_wrap(. ~ Location, labeller = as_labeller(variable_labs)) +
  geom_line(mapping = aes(x = Year,y = Catch, group = SpeciesGroup, color = SpeciesGroup)) +
  scale_y_continuous(limits = c(0, 600)) + 
  scale_x_discrete(breaks = c(2001,2005,2010,2015,2020,2025)) +
   theme(axis.text.x = element_text(angle = 45, hjust = 1),
          strip.text = element_text(size = 5))
```

Unfortunately this plot is too condensed to really get any information out of it, so instead focus on one location.

```{r}
townsville_data <- clean_data %>% filter(Location == "Townsville") #Take only the data from Townsville

 townsville_data$SpeciesGroup <- factor(townsville_data$SpeciesGroup, levels = c("Shark","Other","Turtle","Mammal")) #Reorder the species group so the legend is in an intuitive order

plot2 <- townsville_data %>% ggplot() +
  theme_bw() +
    geom_line(mapping = aes(x = Year,y = Catch, group = SpeciesGroup, color = SpeciesGroup), size = 1) +
   geom_point(mapping = aes(x = Year,y = Catch, group = SpeciesGroup, color = SpeciesGroup, shape = SpeciesGroup), size = 3) +
  scale_y_log10() + #use a log scale because a normal scale does not show the difference between turtle and mammal
  scale_x_discrete(breaks = c(2001,2005,2010,2015,2020,2025)) +
  labs(title = "Townsville", color = "Species Group", shape = "Species Group") +
   theme(axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10),
         axis.text.y = element_text(size = 10),
         axis.title = element_text(size = 15),
          strip.text = element_text(size = 5),
         plot.title = element_text(hjust = 0.5, size = 20)) +
   scale_color_manual(values=c("darkgreen", "purple", "darkblue","orange")) +
  scale_shape_manual(values = c(15:19))
  

plot2
```

Save this plot to your output folder.

```{r}
ggsave("../output/Catch_plot.png")
```

